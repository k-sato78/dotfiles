# TCT20190301

【背景・目的】
次期システムを検討中
現行システムからデータをレプリケーションしたい

ODSにzosからデータを持ってくる

更新情報を差分DBに保存して、それをMQで飛ばしてODSを更新


1UOWは1トランザクション
複数DB更新があってそれが送る長くなるから、メッセージを分割する


トランザクション内の順序性、トランザクション間の保険証券番号の順序性ももとめられる


複数のDBの更新の順序性はもとめられる

ODSには断面が保存される
LPARは6系統　一LPARに１QMGR

手組みでレプリケーションを行いたい

トランザクション単位でまとめてputしたい


更新順序は、単一の対象に関しては順序を守りたいけど
それ以外はどうでもいい
10秒以内に反映
サイズ
1000k~1M
max200M
2m以上は2mごとに分割して送信(何かのアプリつかう)

24/365
PRO一分
PTO24h
ゼット　ｚOSV2,1 MQ V8
RHEL　V7.6 V9.1(未定)


アプライプロセスはETLサーバーに
ETLサーバーがODSを更新

さぶんDBはロック競合軽減のためにたくさん作る


クラスタにしたい(意味は特にない)


質問

1. クラスタにしてホスト側とアプライ側のキュー名を同じにしたい



クラスタを組んで、グループメッセージだけをグループに送るようにする


アプリケーションが、証券番号の順序保証するならできる



さぶんDB には証券番号単位で順序保証されたデータが入っている
ので差分DB→MQは一経路だけでやる

負荷分散はむり

その場合同名のキューはむり


オープンMQ

1. クラスタ+MIQMGR
　MQで順序保証できないよ
	オープン側の復旧要件が1分以内で、MIQMGR

2. MIQMGR
	MIQMGRでおくる

名前を分ける場合は、クラスタとリモートキューの違いはない


クラスタだけだと、障害が起きたところに貯まるし、経路がかわってしまう




1. 可用性 MIQMGR＋クラスタ

だめになったキューに残ったメッセージがあれば移行しても意味がない(トランザクションが保証されない)

からクラスタでやる意味ないかな


MIQMGRで可用性を高める方向性


1. ホスト側のQMGRが何らかの障害が起きた場合、違うLPARを立てて継続できるか
- さっきと同様にやる意味がない
- 全体的な監視を考えるべき
1. 複数のクラスタにしょぞくすることはできるのか
- 可能
1. 何らかの障害でQに滞留したまま、メインCenterが落ちてしまった、サブセンターを開始しなくてはならない場合、溜まったキューをどう処理したらよいか
- 普通はそんなことしない
- あとでメッセージをアンロードするユーティリティをつたえる


1. その他
- 質問後5  N/A
-
- ホストメッセージのセグメント化はできない
- 拡張ページセットに関しては特に考慮点なし
-





サーバーの範囲で
