# SLIQA26
2-1.閲覧処理に関しては、MSG滞留が発生しないと考えてよいか。

メッセージの滞留を無期限のメッセージ滞留のこととしますと、発生する可能性はあります。



expiryで設定された時間が経過したメッセージがキューから廃棄されるタイミングは、そのメッセージがBrowse、もしくはGetされるタイミングです。
今回クライアントアプリは、相関IDで特定のメッセージを読み取る作りになると伺っております。
したがって、クライアントアプリが④ の処理の前に何らかの問題で落ちた場合、次にそのクライアントアプリがメッセージをGetするまで、メッセージは滞留をします。

メッセージ滞留の対策として、以下の3つの方法が考えられます。
1. QMGR属性の"EXPRYINT"を設定する。設定した場合、設定した間隔毎にキューがスキャンされ、有効期限切れのメッセージが削除されます。
2. 一定時間毎にキュー内のすべてのメッセージをブラウズする常駐タスクを使用する
3. 一定時間毎にQMGRを再起動する。(nonpersistentのメッセージであるため、再起動で削除される)

上記の方法で設定した間隔+メッセージのexpiryで設定した値がメッセージの最大滞留時間となります。
キューのサイズと実際の処理の量を鑑みて設定してください。


2-2.登録処理に関しては、どのような懸念／対策が考えられるか。

赤枠で囲まれたexpiry,persistenceの設定は可能です。
また、メッセージの滞留は、特に障害時等で発生する可能性があります。
全体のフローやアプリケーションの設計に関して、この資料だけでは、理解しきれなかったため、今後ミーティングの中で、懸念点や対策についてお話していきたいと思います。




