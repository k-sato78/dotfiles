# TCT20190110SonyLife

【背景・目的】
ソニー生命様は、IWPMのサポート終了に伴い、アプリケーションの新規構築及び、MQの新規導入を検討されています。
今回の新規構築に関係するプロセスは参照処理と登録処理の２つです。
それぞれの処理の詳細は以下になります。
- 参照処理
PCOMから実行したCICSのジョブによりDBに存在する該当画像イメージを含むMQメッセージが作成され、PCOMを起動した端末に存在するMQクライアントが受信する。
- 登録処理
PCOMから実行したCICSのジョブにより、アプリケーションが登録を受け付け、その後MQクライアントから画像イメージ含むメッセージをPUTするとそれを契機に登録処理が行われる。

また、移行は4段階に分けて行われます。
一段階目は、DBの移行
二段階目は、参照処理においての新規アプリ及びMQの導入(過去のアプリと併用)
三段階目は、登録処理においての新規アプリ及びMQの導入(過去のアプリと併用)
四段階目は、旧アプリの廃止
となっています。

今回のTCTでは事前に頂いた質問についてお答えしました。

- バージョン等
z/OS V2.1
MQ V9.0


[ご質問]

1. 今回のアプリケーション構築にあたり、ホストMQとPCのMQ Clientの連携方法についてアドバイスをお願いします。
ホストのPCOMからCICSトランザクションを起動し、ホストMQに対して画像データをPUTし、MQ Client側がGETする想定です。
この際、端末の識別子として何を利用するのが一般的かわかりますでしょうか（LU、IP Address、UserIDなどいくつか案が出てきています）


ホストのPCOMからCICSトランザクションを起動し、ホストMQに対して画像データをPUTし、MQ Client側がGETするという方法はあまり一般的でないため、端末の識別子として一般的なものはわかりません。


- できれば簡単な方法でやりたい いままではLUとかIP Address
- PCOMMとMQクライアントを併用するという前提であれば、端末管理からは逃れづらい
- MQから出して受け取るならかんたん
- 何で管理するかはシステム全体で決めること
- CICSでログオンの情報を読み取って、それをこーれるIDに入れればできなくない
- 並行稼動も考えられるから、端末管理は必要


- IDを入れて受け取るときにもIDを入れれば
- 任意の値をｋeyにしてGETするのはよくあること

- CICS

- IDでやるのが簡単？　共通稼働はどうするの？

- CICSはLUで判断できる(前のTCT)　けどUSERIDが取れるかどうかはわからない

- 同時接続数は数千
- 端末数は1万台(あくまで想定)



- 決めの問題

-


1. メッセージの滞留が発生した場合の対応
		- 一定時間経過後に削除されるようにしたいが、どのように運用するのが適切か）　※送信キューと記載されている側
		- 登録用のトランザクションは処理がされずに残っていた場合、一定時間後にアラートを出すなど気づけるようにしたい　※受信キューと記載されている側



通常どう扱うのかが聞きたい
per nonperも決まってない


調査のためにメッセージを残すこともある

消していいならエクスパイありーをつける

実際に消えるのはget時に消える

keyで検索していると消えない

5分に一回エクスパイありータスクで消せる(エクスパイありーが来てるやつだけ消せる)

夜中にクリアもある


perにすると再起動してものこるよ

nonperなら再起動で消える


エクスパイありーのレポートメッセージで確認できる
別のキューに退避いって

バックアウトカウントは残るけどなんでバックアウトしたかはわからない

あんまりあっても意味ない？


- 2

massageAgeでいちばん古いのが何秒入りっぱなしかどうかはわかる

mqでは何かあるわけではなくて、関しの仕組みを作る必要がある

何をかんしするのかを考える必要がある

qmaxdepthを超えたらイベントキューに描くってことはできる

イベントキューを監視するのは自分で組むのか製品入れるのかはご自由にどうぞ


Omegamon MQ つかわれてる？
新しく和尚を入れる人はあまり聞いてない


OMEGAMON MQは何してくれる？

イベントキューの監視からのアラート、SYSLOGへの出力等

全機能必要あるか、手組したほうがいいんでは？


今使ってる監視ツール
The monitor
ASG

MQ和尚は日本IBMで販売してると思われる
メンテナンスはISEの一部のメンバが対応

夜間バッチにするかその場でエラー返すのかは決め



都度起動じゃなくて、来たもの全部登録するの


トリガーモニタを利用したいときはメモリへの影響を考えたとき


CICS- MQ なら常駐でGETWAIT



1. 現在、要件定義のフェーズで要件を調整中ですが、MQの運用要件として初期段階で合意しておくべき仕様がありましたらアドバイスください（詳細な設計は後の工程ですが大枠の使い方は合意しておきたいと思っています）

監視要件
高可用性→月イチでIPL(めんて) CICSはmono だから単体レベル 障害時は再起動 cold-stanby
サービスの提供時間
パフォーマンス管理 SMFをみるか サポートパックで提供されている 現行同等レベルならばシスログでいい？
トランザクション量　パフォーマンス、リソースに影響
per nonper ディすく容量に関わる
セキュリティ要件(SSL,conauth等)


BUFFERPOOL
使用量なら見れる

ARMでの再起動はできる？
できる





1. MQの事前検証用環境を使ってみたいとの要望をいただいているのですが、ホスト環境の構築を行なうには期間が厳しく、PC環境を使うなど簡易に環境を使う方法はないでしょうか

WindowsかLinuxにいれる
MQonCloudに入れる SIL添付


1. 当環境では、RACFではなく、TOP Secretを利用していますが、特別な考慮点はありますでしょうか
特になし





***
メモ
***

契約書イメージを保管しておいてそれを表示したい

画像イメージをクライアントに表示
データが滞留した場合は再利用しないから時間が経過したら消したい

イメージを読み込んでデータを登録するのもある

3-開発を進める中で、MQを触ってみたい　ホストに入れるのは8月以降になっちゃうからホスト以外で入れられる物が欲しい

4. セキュリティどうするのかっていうとこを聞きたい


現行はIWPMを利用してる
PCMM→CICS→

現行
PCOMがCICS起動してIWPMが


IWPMとPCOMは同じ端末
投げたところに帰ってくる

別のところにIWPMがあってそこにそれを返す


DBでLUとIPADDRESSで管理していてそれで紐づけて返してる




1段階目

イメージの登録を２つのDBに登録を行う

2段階目


旧アプリと新アプリの並行稼動
(参照のみ


3段階目

登録の仕組みを新しいアプリにいれる


PCOMMで登録のシグナルを送って、その後にMQPUTで画像をputする
PCOMMでは契約情報を送りMQで画像を付与するイメージ







クライアントPCはwindows10の予定
host zos 2.1
hostはv9.0.0
windowsはv9.1.0がはいるけどどうする？


再配布可能クライアントの利用も視野
versionupが簡単だけど開発できない

コンパイルまでできるけどQへのアクセスはできないから


データのサイズ 数MB
基本的には１MB以下


速度を求めている(画像の表示の



