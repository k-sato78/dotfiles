# tct191206


BSDS

https://www.ibm.com/support/knowledgecenter/ja/SSFKSJ_8.0.0/com.ibm.mq.con.doc/q019260_.htm
```
最新バージョンの CSQ4BSDS を使用するか、JCL を手動で更新して RECORDS(850 60) を使用しなければなりません。
```

アクティブログ
https://www.ibm.com/support/knowledgecenter/ja/SSFKSJ_8.0.0/com.ibm.mq.con.doc/q018476_.htm

```
キュー・マネージャーが必要とするアクティブ・ログのサイズを見積もります。

アクティブ・ログのサイズの上限を次に示します。
logsize = (primaryfiles + secondaryfiles) * logfilepages * 4096コピー
ログは、キュー・マネージャーがディスクに書き込む 1 秒あたりのデータ量が最大の状態で、実行時間が最長のトランザクションを処理できる十分な大きさにする必要があります。

実行時間が最長のトランザクションの実行時間が N 秒で、キュー・マネージャーがディスクに書き込む 1 秒あたりの最大データ量がログで 1 秒あたり B バイトである場合、ログを次のサイズ以上にする必要があります。
logsize >= 2 * (N+1) * Bコピー
キュー・マネージャーがディスクに書き込む 1 秒あたりのデータ量が最大になる可能性があるのは、ワークロードのピーク時に実行する場合、あるいはメディア・イメージを記録する場合です。
```

ページセットみつもり

余裕率見たほうが良さそう

処理の内容、量、Qの配置、利用法による

できれば別のディスクのほうがいい
使うやつを分ける





概要。目的　　　　　　　
Classic CDCを使用してホストデータを分散サーバー側にレプリケーションする基盤を構築します。データ連携にはCCDCに同梱されるMQ V8.0を使用します。
設計自体はお客様にて実施されますが、「設計根拠となる参考資料」という位置づけで、MQ設計の考慮点等をまとめた参考資料を作成しております。
考慮点を網羅できているか、資源の見積もりやパラメーター指定の考え方が正しいか、といった観点で資料のレビュー、およびQAをうけていただければと思います。

設計はお客さんがやる
設計の参考資料を作成

お客さんはMQつかってはいるけれど、意識して使っていない　導入はISE?
から、マニュアル読んだりしない

これを参考にマニュアルは参照する前提でおｋ


V8のサポートはCCDCのサポートまで自動的に延長される
V9へのVupもかんがえている

運用、監視、リカバリに関しても資料に盛り込む？
構築までがこの資料の範囲ない
構成までであれば、目次にかかれているところでokだけど、詳細はマニュアルを見ながらやって


セキュリティーなし



現状V6が動いてるけど、上位early cordを適応すればok?
ok

一日でどれくらいのログ量かを計算して4Gのdsなんこ分という計算で

循環するアクティブログすべてで一日分入る

現状、32k*2/s ave 600k max 6m

64*60*60*24/1024≒5G
2G*4とか？



pageset0 の見積もり 5000 か1000くらいでいいんじゃ


pageset1 の見積もり

かくのうの仕方はok

滞留数*メッセージ長

相手のqmgrが落ちているときにどうするのか

処理対応時間等も考えて

何分貯められるのかを考える

ccdcを止めるかどうかどうするのがふつう？

それは考え方による
何を優先するか

なにか起きたときにいつ頃どこで止めるかということはリカバリーの設計で必要で、見積もりにはその上でおこなう

チャネルは溜まってる分全部送っちゃうの？秒何件でおくってとかできない？
全部送る

バッファープールはチャネルに送るときにもつかうの？
使う、pagesetからバッファープールに読み出してからチャネルに送る


bufferpool は実メモリ取られる?
V8は2g aboveだとfixedでとれる
2g belowだとfixでない

bufferpoolはあとから拡張可能？


pagesetの数量

pagesetに対してbufferpoolを
bufferpool 85%を超えるとpagesetへの書き込みがはいるからその影響を避けたいなら分ける

要件に合わせてつくって


V８新規導入
opmodeどうする？
新規ならnewfuncでいい
2g aboveとか8byte rbaにできるからよい


bufferpool のサイズ、個数は要件次第のため、見積もりして

SMFACCT
SMFSTAT

statはそんなに増えない

accunt のclass3はCPU負荷は増える class1だけならそんなに増えない

pagesetの配置について話してないからはなす
チャネル転送時間はaccunt  をとっても見れない


チャネル

CHIADAPS
CHDISPS　　　
これの本番環境のマニュアルの値は大規模mqネットワークが構成される場合のもの
チャネル10ぽんいかなら、でふぉでいい

でっとれたーは使わない(奥川)


psmodeがenableのときしかinptが読まれないからok


channelauthはdisabledにしないの？

QMGR間接続の場合は、デフォルトのchannelauthであれば問題ない。
カスタムして、適応するのであればマニュアルよんで


max depthとpagesetの話

max depth は件数
pageset 容量

監視する際に、XMITQ をするかどうかで、
件数で滞留をけんちするか、(maxdepthで監視)
pagesetの使用量で検知するかによって設計は変わる


メッセージレングスは調整


HBINTが30になってるのはなんで

しらん
障害検知を早くしたいのであれば、調整
SILをはる


分散MQのHBはあわせる？

あわせないとおっきい方にあう

分散
AIX V9.0.0
java or cobol

JMS
groupmassegeつかえる？
多分


https://www.ibm.com/support/knowledgecenter/ja/SSFKSJ_9.0.0/com.ibm.mq.dev.doc/q032350_.htm

2pcにするかどうかの選択はどう決めればいい？

2pcの負荷の計算をして、どうしても負荷を軽減したいのであれば2pcを選択しないという方式もありかと

2pcの結果はパフォーマンスレポートになければない

pocで試して見るのが良いと思う



qのなかでメッセージが入れ子にならないか
チャネル一本だからおｋ

all message avairableになってれば全部きたらとる？
そう


insert後にgetすればよくねという　markoptionをつかうとよいかも


getのタイミングでぽしゃったら残る


mq資源分割について


チャネルの分割は
一本でだめだたら日本とかでいいんじゃ
用途が変わらないなら一ぽんでいいのでは
極端にれーとがちがうとか
片方のプログラムの停止の影響を反対側が受けないようにしたいなら分ける


片方のキューがパンクするともう片方がパンクしてなくてもチャネルがストップする


nettimeはどこからどこまでかわからないので参考程度で:






pagesetは別々にしたほうがdiscI/Oがわかれるからよい

pagesetを4gb以上にするならsmsが必要




